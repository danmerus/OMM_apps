import streamlit as st
import numpy as np

st.set_page_config(page_title="OMM ‚Äì –ø—Ä–æ–≥–Ω–æ–∑ –°–°–ó–†–ü –ú–•–î–ê", page_icon="üçº")

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  HEADER  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
st.header("OMM –ü–†–û–ì–ù–û–ó –°–ó–†–ü –ú–•–î–ê")

st.markdown(
"""
**–¶–µ–ª—å**  
1. –ü–æ –¥–∞–Ω–Ω—ã–º I-–≥–æ —Ç—Ä–∏–º–µ—Å—Ç—Ä–∞ (11 ‚Äì 13 ‚Å∂/‚Çá –Ω–µ–¥–µ–ª—å) –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Ä–∏—Å–∫ —Å–∏–Ω–¥—Ä–æ–º–∞
—Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–æ—Å—Ç–∞ –ø–ª–æ–¥–∞ (–°–°–ó–†–ü).  
2. –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ —É—Ç–æ—á–Ω–∏—Ç—å –≤–µ—Ä–æ—è—Ç–Ω—ã–π –∏—Å—Ö–æ–¥ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ
–ø—É–ª—å—Å–∞—Ü–∏–æ–Ω–Ω–æ–º—É –∏–Ω–¥–µ–∫—Å—É (–ü–ò) –≤–µ–Ω–æ–∑–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–∞.
"""
)

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  INPUTS  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
st.header("–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö (I-–π —Ç—Ä–∏–º–µ—Å—Ç—Ä)")

def to_float(val):
    """–°—Ç—Ä–æ–∫–∞ ‚Üí float –∏–ª–∏ None, –µ—Å–ª–∏ –ø—É—Å—Ç–æ/–Ω–µ —á–∏—Å–ª–æ."""
    try:
        return float(val) if val not in ("", None) else None
    except ValueError:
        return None

col1, col2 = st.columns(2)

with col1:
    ktr1 = to_float(st.text_input("–ö–¢–† 1, –º–º"))
    tvp1 = to_float(st.text_input("–¢–í–ü 1, –º–º"))
with col2:
    ktr2 = to_float(st.text_input("–ö–¢–† 2, –º–º"))
    tvp2 = to_float(st.text_input("–¢–í–ü 2, –º–º"))

tkr = st.radio(
    "–ü–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç—Ä–∏–∫—É—Å–ø–∏–¥–∞–ª—å–Ω–∞—è —Ä–µ–≥—É—Ä–≥–∏—Ç–∞—Ü–∏—è (–¢–ö–†) —É —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø–ª–æ–¥–∞:",
    options=[0, 1],
    format_func=lambda x: "–ï—Å—Ç—å" if x == 1 else "–ù–µ—Ç",
    horizontal=True,
)

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  –ö–ù–û–ü–ö–ê –†–ê–°–ß–Å–¢–ê  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫ –°–°–ó–†–ü"):
    all_entered = None not in (ktr1, ktr2, tvp1, tvp2)

    if not all_entered:
        st.warning("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —á–µ—Ç—ã—Ä–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª—è.")
        st.stop()

    # ----------   –≠—Ç–∞–ø 1: —Ä–∏—Å–∫ –°–°–ó–†–ü   ----------
    Z = (
        2.75
        + 0.20 * (ktr1 - ktr2)
        + 0.71 * (tvp1 - tvp2)
        - 3.75 * min(tvp1, tvp2)
        + 2.27 * tkr
    )
    prob = 1 / (1 + np.exp(-Z))

    st.subheader("–†–µ–∑—É–ª—å—Ç–∞—Ç I-–≥–æ —ç—Ç–∞–ø–∞")
    st.write(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –°–°–ó–†–ü: **{prob:.3f}**")

    risk_high = prob > 0.15
    if risk_high:
        st.error("‚ö†Ô∏è –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –°–°–ó–†–ü")
    else:
        st.success("–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –°–°–ó–†–ü")

    # ----------   –≠—Ç–∞–ø 2: –ø—Ä–æ–≥–Ω–æ–∑ –∏—Å—Ö–æ–¥–∞   ----------
    st.subheader("2-–π —ç—Ç–∞–ø ‚Üí –ø—Ä–æ–≥–Ω–æ–∑ –∏—Å—Ö–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ)")

    if risk_high:
        pi_val = to_float(
            st.text_input("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ü–ò –≤ –≤–µ–Ω–æ–∑–Ω–æ–º –ø—Ä–æ—Ç–æ–∫–µ, –µ–¥.")
        )
        if pi_val is not None:
            if pi_val > 1.3:
                st.error(
                    "–ü—Ä–æ–≥–Ω–æ–∑: –≤–µ—Ä–æ—è—Ç–Ω–∞ –≥–∏–±–µ–ª—å –æ–¥–Ω–æ–≥–æ/–¥–≤—É—Ö –ø–ª–æ–¥–æ–≤.\n\n"
                    "üëâ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–∞–≥—É–ª—è—Ü–∏—é —Å–æ—Å—É–¥–æ–≤ –ø—É–ø–æ–≤–∏–Ω—ã –º–µ–Ω—å—à–µ–≥–æ –ø–ª–æ–¥–∞."
                )
            else:
                st.success(
                    "–ü—Ä–æ–≥–Ω–æ–∑: –æ–±–∞ –ø–ª–æ–¥–∞, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤—ã–∂–∏–≤—É—Ç.\n\n"
                    "üëâ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ."
                )
        else:
            st.info("–í–≤–µ–¥–∏—Ç–µ –ü–ò –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –∏—Å—Ö–æ–¥–∞.")
