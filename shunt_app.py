# app.py
import streamlit as st
import numpy as np

st.set_page_config(page_title="ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· & Ğ¨ÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ", page_icon="ğŸ¼")
st.header("Ğ¡ĞŸĞĞ¡ĞĞ‘ ĞĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ•ĞĞ˜Ğ¯ ĞŸĞ ĞĞ“ĞĞĞ—Ğ Ğ˜ ĞĞ•ĞĞ‘Ğ¥ĞĞ”Ğ˜ĞœĞĞ¡Ğ¢Ğ˜ Ğ’ĞĞ£Ğ¢Ğ Ğ˜Ğ£Ğ¢Ğ ĞĞ‘ĞĞĞ“Ğ ĞĞ•Ğ¤Ğ ĞĞĞœĞĞ˜ĞĞ›Ğ¬ĞĞĞ“Ğ Ğ¨Ğ£ĞĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ¯ Ğ£ ĞŸĞ›ĞĞ”ĞĞ’ Ğ¡ Ğ’Ğ ĞĞ–Ğ”Ğ•ĞĞĞ«ĞœĞ˜ ĞĞ‘Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ˜Ğ’ĞĞ«ĞœĞ˜ Ğ£Ğ ĞĞŸĞĞ¢Ğ˜Ğ¯ĞœĞ˜")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# helpers
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def num_or_none(v):
    v = v.replace(",", ".").strip()
    return float(v) if v else None

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# I. ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ (WI)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("I ÑÑ‚Ğ°Ğ¿. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ²Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ¿Ğ°Ñ‚Ğ¸Ğ¸ Ñƒ Ğ¿Ğ»Ğ¾Ğ´Ğ°")

c1, c2 = st.columns(2)
with c1:
    x1 = st.checkbox("Ğ”Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½ĞµĞµ Ğ¿Ğ¾Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ‡ĞµĞº (Ğ¥1)")
    x2 = st.checkbox("ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ» (Ğ¥2)")
with c2:
    x3 = st.text_input("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ğ¾Ñ‡ĞºĞ¸, Ğ¼Ğ¼ (Ğ¥3)")
    x4 = st.text_input("Ğ¢Ğ¾Ğ»Ñ‰Ğ¸Ğ½Ğ° Ğ¿Ğ°Ñ€ĞµĞ½Ñ…Ğ¸Ğ¼Ñ‹, Ğ¼Ğ¼ (Ğ¥4)")
    x5 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ğ°ÑĞºÑƒĞ»ÑÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ VI (Ğ¥5)")
    x6 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° FI (Ğ¥6)")

def calc_wi():
    vals = [
        int(x1),
        int(x2),
        num_or_none(x3),
        num_or_none(x4),
        num_or_none(x5),
        num_or_none(x6),
    ]
    if None in vals[2:]:
        st.session_state.wi_error = "Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ (Ğ¥3-Ğ¥6)."
        return
    b = np.array([-0.292, -1.551, -0.054, 0.221, 0.065, 0.416])
    wi = float(np.dot(b, vals) - 4.673)
    st.session_state.wi = wi          # ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼
    st.session_state.wi_error = None

st.button("Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ WI", on_click=calc_wi)

# Ğ²Ñ‹Ğ²Ğ¾Ğ´ WI
if "wi_error" in st.session_state and st.session_state.wi_error:
    st.warning(st.session_state.wi_error)
elif "wi" in st.session_state:
    wi = st.session_state.wi
    st.subheader(f"WI = {wi:.3f}")
    if wi < 0:
        st.error("ĞĞµĞ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·")
    else:
        st.success("Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· â€“ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¹Ñ‚Ğ¸ ĞºĞ¾ 2-Ğ¼Ñƒ ÑÑ‚Ğ°Ğ¿Ñƒ")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# II. Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ (DI)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if st.session_state.get("wi", -1) >= 0:
    st.header("II ÑÑ‚Ğ°Ğ¿. Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ½ĞµÑ„Ñ€Ğ¾Ğ°Ğ¼Ğ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑˆÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñƒ Ğ¿Ğ»Ğ¾Ğ´Ğ¾Ğ² Ñ Ğ¾Ğ±ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ÑƒÑ€Ğ¾Ğ¿Ğ°Ñ‚Ğ¸ÑĞ¼Ğ¸.")

    d1, d2 = st.columns(2)
    with d1:
        y1 = st.text_input("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ğ¾Ñ‡ĞºĞ¸, Ğ¼Ğ¼ (Y1)")
        y2 = st.text_input("Ğ¢Ğ¾Ğ»Ñ‰Ğ¸Ğ½Ğ° Ğ¿Ğ°Ñ€ĞµĞ½Ñ…Ğ¸Ğ¼Ñ‹, Ğ¼Ğ¼ (Y2)")
        y3 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ğ°ÑĞºÑƒĞ»ÑÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ VI (Y3)")
        y4 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° FI (Y4)")
    with d2:
        y5 = st.checkbox("ĞŸĞ¾Ñ‡ĞºĞ°-ĞºĞ¸ÑÑ‚Ğ° (Y5)")
        y6 = st.checkbox("ĞšĞ¸ÑÑ‚Ğ¾Ğ·Ğ½Ğ°Ñ Ğ´Ğ¸ÑĞ¿Ğ»Ğ°Ğ·Ğ¸Ñ (Y6)")

    def calc_di():
        vals = [
            num_or_none(y1),
            num_or_none(y2),
            num_or_none(y3),
            num_or_none(y4),
            int(y5),
            int(y6),
        ]
        if None in vals[:4]:
            st.session_state.di_error = "Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ (Y1-Y4)."
            return
        a = np.array([0.017, 0.222, 0.565, -0.388, 5.589, 7.005])
        di = float(np.dot(a, vals) - 0.463)
        st.session_state.di = di
        st.session_state.di_error = None

    st.button("Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ DI", on_click=calc_di)

    if "di_error" in st.session_state and st.session_state.di_error:
        st.warning(st.session_state.di_error)
    elif "di" in st.session_state:
        di = st.session_state.di
        st.subheader(f"DI = {di:.3f}")
        if di < 0:
            st.error("ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑÑ‚Ğ¸ Ğ½ĞµÑ„Ñ€Ğ¾Ğ°Ğ¼Ğ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑˆÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ")
        else:
            st.success("ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğ¹ Ğ´Ğ»Ñ ÑˆÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½ĞµÑ‚")
