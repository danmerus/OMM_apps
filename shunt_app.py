# app.py  (Streamlit 1.33+)

import streamlit as st
import numpy as np
import datetime as dt

st.set_page_config(page_title="ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· & Ğ¨ÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ", page_icon="ğŸ¼")

st.header("Ğ¡ĞŸĞĞ¡ĞĞ‘ ĞĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ•ĞĞ˜Ğ¯ ĞŸĞ ĞĞ“ĞĞĞ—Ğ Ğ˜ ĞĞ•ĞĞ‘Ğ¥ĞĞ”Ğ˜ĞœĞĞ¡Ğ¢Ğ˜ Ğ’ĞĞ£Ğ¢Ğ Ğ˜Ğ£Ğ¢Ğ ĞĞ‘ĞĞĞ“Ğ ĞĞ•Ğ¤Ğ ĞĞĞœĞĞ˜ĞĞ›Ğ¬ĞĞĞ“Ğ Ğ¨Ğ£ĞĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ¯ Ğ£ ĞŸĞ›ĞĞ”ĞĞ’ Ğ¡ Ğ’Ğ ĞĞ–Ğ”Ğ•ĞĞĞ«ĞœĞ˜ ĞĞ‘Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ˜Ğ’ĞĞ«ĞœĞ˜ Ğ£Ğ ĞĞŸĞĞ¢Ğ˜Ğ¯ĞœĞ˜")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ²ÑĞ¿Ğ¾Ğ¼-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ: Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ²Ğ²Ğ¾Ğ´ float / int
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def num_or_none(value: str, cast=float):
    value = value.replace(",", ".").strip()
    return cast(value) if value else None


# ============== I. ĞŸĞ ĞĞ“ĞĞĞ— (WI) ==============

st.header("I ÑÑ‚Ğ°Ğ¿. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ²Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ¿Ğ°Ñ‚Ğ¸Ğ¸ Ñƒ Ğ¿Ğ»Ğ¾Ğ´Ğ°.")

col1, col2 = st.columns(2)
with col1:
    x1 = st.checkbox("Ğ”Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½ĞµĞµ Ğ¿Ğ¾Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ‡ĞµĞº (Ğ¥1)", value=False)
    x2 = st.checkbox("ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ» (Ğ¥2)", value=False)

with col2:
    x3 = st.text_input("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ğ¾Ñ‡ĞºĞ¸, Ğ¼Ğ¼ (Ğ¥3)", key="x3")
    x4 = st.text_input("Ğ¢Ğ¾Ğ»Ñ‰Ğ¸Ğ½Ğ° Ğ¿Ğ°Ñ€ĞµĞ½Ñ…Ğ¸Ğ¼Ñ‹, Ğ¼Ğ¼ (Ğ¥4)", key="x4")
    x5 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ğ°ÑĞºÑƒĞ»ÑÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ VI (Ğ¥5)", key="x5")
    x6 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° FI (Ğ¥6)", key="x6")

if st.button("Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ğ´ĞµĞºÑ"):
    # Ğ¿Ñ€ĞµĞ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ² Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ None
    vals = [
        int(x1),
        int(x2),
        num_or_none(x3),
        num_or_none(x4),
        num_or_none(x5),
        num_or_none(x6),
    ]
    if None in vals[2:]:
        st.warning("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ.")
    else:
        b = np.array([-0.292, -1.551, -0.054, 0.221, 0.065, 0.416])
        const_wi = 4.673
        wi = np.dot(b, vals) - const_wi
        st.subheader(f"WI = {wi:.3f}")
        if wi < 0:
            st.error("ĞĞµĞ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·")
        else:
            st.success("Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· â€“ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¹Ñ‚Ğ¸ ĞºĞ¾ 2-Ğ¼Ñƒ ÑÑ‚Ğ°Ğ¿Ñƒ")

            st.session_state["prognosis_ok"] = True  # Ñ„Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ ÑˆĞ°Ğ³Ğ° II
else:
    st.session_state["prognosis_ok"] = False

# ============= II. Ğ¨Ğ£ĞĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• (DI) =============
if st.session_state.get("prognosis_ok"):
    st.header("II ÑÑ‚Ğ°Ğ¿ â€“ Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ½ĞµÑ„Ñ€Ğ¾Ğ°Ğ¼Ğ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑˆÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñƒ Ğ¿Ğ»Ğ¾Ğ´Ğ¾Ğ² Ñ Ğ¾Ğ±ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ÑƒÑ€Ğ¾Ğ¿Ğ°Ñ‚Ğ¸ÑĞ¼Ğ¸.")

    c1, c2 = st.columns(2)
    with c1:
        y1 = st.text_input("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ğ¾Ñ‡ĞºĞ¸, Ğ¼Ğ¼ (Y1)", key="y1")
        y2 = st.text_input("Ğ¢Ğ¾Ğ»Ñ‰Ğ¸Ğ½Ğ° Ğ¿Ğ°Ñ€ĞµĞ½Ñ…Ğ¸Ğ¼Ñ‹, Ğ¼Ğ¼ (Y2)", key="y2")
        y3 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ğ°ÑĞºÑƒĞ»ÑÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ VI (Y3)", key="y3")
        y4 = st.text_input("Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° FI (Y4)", key="y4")

    with c2:
        y5 = st.checkbox("ĞŸĞ¾Ñ‡ĞºĞ°-ĞºĞ¸ÑÑ‚Ğ° (Y5)", value=False)
        y6 = st.checkbox("ĞšĞ¸ÑÑ‚Ğ¾Ğ·Ğ½Ğ°Ñ Ğ´Ğ¸ÑĞ¿Ğ»Ğ°Ğ·Ğ¸Ñ Ğ¿Ğ¾Ñ‡ĞºĞ¸ (Y6)", value=False)

    if st.button("Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ DI"):
        vals2 = [
            num_or_none(y1),
            num_or_none(y2),
            num_or_none(y3),
            num_or_none(y4),
            int(y5),
            int(y6),
        ]
        if None in vals2[:4]:
            st.warning("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ.")
        else:
            a = np.array([0.017, 0.222, 0.565, -0.388, 5.589, 7.005])
            const_di = 0.463
            di = np.dot(a, vals2) - const_di
            st.subheader(f"DI = {di:.3f}")
            if di < 0:
                st.error("ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ½ĞµÑ„Ñ€Ğ¾Ğ°Ğ¼Ğ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑˆÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ")
            else:
                st.success("ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğ¹ Ğ´Ğ»Ñ ÑˆÑƒĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½ĞµÑ‚")
