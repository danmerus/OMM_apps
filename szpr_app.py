import streamlit as st
import numpy as np

st.set_page_config(page_title="OMM ‚Äì –ø—Ä–æ–≥–Ω–æ–∑ –°–°–ó–†–ü –ú–•–î–ê", page_icon="üçº")

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  HEADER  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
st.header("OMM –ü–†–û–ì–ù–û–ó –°–ó–†–ü –ú–•–î–ê")

st.markdown(
"""
**–¶–µ–ª—å**  
1. –ü–æ –¥–∞–Ω–Ω—ã–º I-–≥–æ —Ç—Ä–∏–º–µ—Å—Ç—Ä–∞ (11 ‚Äì 13 ‚Å∂/‚Çá –Ω–µ–¥–µ–ª—å) –æ—Ü–µ–Ω–∏—Ç—å —Ä–∏—Å–∫ —Å–∏–Ω–¥—Ä–æ–º–∞
—Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–æ—Å—Ç–∞ –ø–ª–æ–¥–∞ (–°–°–ó–†–ü).  
2. –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ —É—Ç–æ—á–Ω–∏—Ç—å –∏—Å—Ö–æ–¥ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ –ø—É–ª—å—Å–∞—Ü–∏–æ–Ω–Ω–æ–º—É
–∏–Ω–¥–µ–∫—Å—É (–ü–ò) –≤–µ–Ω–æ–∑–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–∞.
"""
)

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  INPUTS  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
st.header("–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö (I-–π —Ç—Ä–∏–º–µ—Å—Ç—Ä)")

def to_float(txt: str | None) -> float | None:
    """–°—Ç—Ä–æ–∫–∞ ‚Üí float, –ª–∏–±–æ None, –µ—Å–ª–∏ –ø—É—Å—Ç–æ/–Ω–µ —á–∏—Å–ª–æ."""
    try:
        return float(txt) if txt not in ("", None) else None
    except ValueError:
        return None

c1, c2 = st.columns(2)
with c1:
    ktr1 = st.text_input("–ö–¢–† 1, –º–º")
    tvp1 = st.text_input("–¢–í–ü 1, –º–º")
with c2:
    ktr2 = st.text_input("–ö–¢–† 2, –º–º")
    tvp2 = st.text_input("–¢–í–ü 2, –º–º")

tkr = st.radio(
    "–ü–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç—Ä–∏–∫—É—Å–ø–∏–¥–∞–ª—å–Ω–∞—è —Ä–µ–≥—É—Ä–≥–∏—Ç–∞—Ü–∏—è (–¢–ö–†) —É —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø–ª–æ–¥–∞:",
    options=[0, 1],
    format_func=lambda x: "–ï—Å—Ç—å" if x else "–ù–µ—Ç",
    horizontal=True,
)

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 1-–π –≠–¢–ê–ü ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
st.subheader("1-–π —ç—Ç–∞–ø ‚Üí —Ä–∏—Å–∫ –°–°–ó–†–ü")

if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫ –°–°–ó–†–ü"):
    vals = list(map(to_float, (ktr1, ktr2, tvp1, tvp2)))
    if None in vals:                          # –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ –ø–æ–ª—è
        st.warning("‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –≤—Å–µ —á–µ—Ç—ã—Ä–µ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã.")
        st.stop()

    k1, k2, v1, v2 = vals
    Z = 2.75 + 0.20 * (k1 - k2) + 0.71 * (v1 - v2) - 3.75 * min(v1, v2) + 2.27 * tkr
    prob = 1 / (1 + np.exp(-Z))

    st.session_state["prob"] = prob          # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞
    st.session_state["risk_high"] = prob > 0.15

    st.write(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –°–°–ó–†–ü: **{prob:.3f}**")
    if st.session_state["risk_high"]:
        st.error("‚ö†Ô∏è –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –°–°–ó–†–ü")
    else:
        st.success("–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –°–°–ó–†–ü")

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 2-–π –≠–¢–ê–ü ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if st.session_state.get("risk_high"):
    st.subheader("2-–π —ç—Ç–∞–ø ‚Üí –ø—Ä–æ–≥–Ω–æ–∑ –∏—Å—Ö–æ–¥–∞")

    pi_txt = st.text_input("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ü–ò –≤–µ–Ω–æ–∑–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–∞, –µ–¥.", key="pi_input")

    if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥"):
        pi_val = to_float(pi_txt)
        if pi_val is None:
            st.warning("‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ü–ò.")
            st.stop()

        if pi_val > 1.3:
            st.error(
                "–ü—Ä–æ–≥–Ω–æ–∑: –≤–µ—Ä–æ—è—Ç–Ω–∞ –≥–∏–±–µ–ª—å –æ–¥–Ω–æ–≥–æ/–¥–≤—É—Ö –ø–ª–æ–¥–æ–≤.\n\n"
                "üëâ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–∞–≥—É–ª—è—Ü–∏—é —Å–æ—Å—É–¥–æ–≤ –ø—É–ø–æ–≤–∏–Ω—ã –º–µ–Ω—å—à–µ–≥–æ –ø–ª–æ–¥–∞."
            )
        else:
            st.success(
                "–ü—Ä–æ–≥–Ω–æ–∑: –æ–±–∞ –ø–ª–æ–¥–∞, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤—ã–∂–∏–≤—É—Ç.\n\n"
                "üëâ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ."
            )
